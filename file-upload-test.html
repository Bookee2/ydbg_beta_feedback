<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1e293b; color: #f8fafc; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #059669; }
        .error { background: #dc2626; }
        .info { background: #3b82f6; }
        button { background: #dc2626; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üìé File Upload Test</h1>
    <p>Test uploading files to 0x0.st and getting download links.</p>
    
    <input type="file" id="fileInput" multiple accept="image/*">
    <button onclick="testFileUpload()">Test Upload</button>
    
    <div id="result" class="result"></div>
    <div id="links" class="result"></div>

    <script>
        // Upload file to multiple hosting services with fallbacks
        async function uploadFileToHost(file) {
            const uploadServices = [
                {
                    name: '0x0.st',
                    url: 'https://0x0.st',
                    method: 'POST',
                    body: (file) => {
                        const formData = new FormData();
                        formData.append('file', file);
                        return formData;
                    },
                    parseResponse: (response) => response.text()
                },
                {
                    name: 'file.io',
                    url: 'https://file.io',
                    method: 'POST',
                    body: (file) => {
                        const formData = new FormData();
                        formData.append('file', file);
                        return formData;
                    },
                    parseResponse: async (response) => {
                        const data = await response.json();
                        return data.link;
                    }
                }
            ];
            
            for (const service of uploadServices) {
                try {
                    console.log(`Trying ${service.name}...`);
                    
                    const response = await fetch(service.url, {
                        method: service.method,
                        body: service.body(file),
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const url = await service.parseResponse(response);
                        console.log(`‚úÖ File uploaded successfully to ${service.name}: ${url}`);
                        return url.trim();
                    } else {
                        console.warn(`${service.name} failed with status: ${response.status}`);
                    }
                } catch (error) {
                    console.warn(`${service.name} failed:`, error.message);
                }
            }
            
            throw new Error('All upload services failed');
        }
        
        async function testFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            const linksDiv = document.getElementById('links');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = 'Please select a file first.';
                resultDiv.className = 'result error';
                return;
            }
            
            resultDiv.innerHTML = 'Uploading files...';
            resultDiv.className = 'result info';
            linksDiv.innerHTML = '';
            
            const files = Array.from(fileInput.files);
            const uploadResults = [];
            
            for (const file of files) {
                try {
                    const url = await uploadFileToHost(file);
                    uploadResults.push({
                        name: file.name,
                        size: file.size,
                        url: url
                    });
                } catch (error) {
                    console.error(`Failed to upload ${file.name}:`, error);
                    uploadResults.push({
                        name: file.name,
                        size: file.size,
                        url: null,
                        error: error.message
                    });
                }
            }
            
            // Display results
            const successCount = uploadResults.filter(r => r.url).length;
            const failCount = uploadResults.filter(r => !r.url).length;
            
            resultDiv.innerHTML = `‚úÖ ${successCount} files uploaded successfully, ‚ùå ${failCount} failed`;
            resultDiv.className = successCount > 0 ? 'result success' : 'result error';
            
            // Display download links
            let linksHtml = '<h3>Download Links:</h3>';
            uploadResults.forEach((result, index) => {
                if (result.url) {
                    linksHtml += `<p><a href="${result.url}" target="_blank" style="color: #60a5fa;">üìé ${result.name}</a> (${(result.size / 1024).toFixed(1)} KB)</p>`;
                } else {
                    linksHtml += `<p style="color: #f87171;">‚ùå ${result.name} - ${result.error}</p>`;
                }
            });
            
            linksDiv.innerHTML = linksHtml;
            linksDiv.className = 'result info';
        }
    </script>
</body>
</html>
